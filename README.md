# experiment-scheduler-gas
# 実験参加スケジューラー（Google Apps Script）

2ページ構成（同意→予約）の実験予約アプリ。  
枠はスプレッドシートで管理、2名成立で確定、受付/確定/リマインドメールを自動送信。  
Gmail の送信上限にも配慮（キュー＋毎時処理）、総確定人数の上限も設定可。

## 機能
- 同意ページ → メールの確認入力 → 日時複数選択 → 申し込み
- **2名そろったら確定**（1人1枠制御あり）
- 受付メール → 確定メール → 前日9時にリマインド
- 管理者に確定通知、毎日0時にダイジェスト配信
- 募集枠の追加（特定日時/日/範囲）とキャンセル運用をスプレッドシートだけで
- 確定済みユーザーの「他の希望日時」は自動アーカイブ
- 総確定上限（例：60名）で打ち止め
- 除外日/除外日時、土日除外、明日以降のみ表示


---

## 0. 前提
- Google アカウント（大学の Workspace 推奨）
- 新しい Google **スプレッドシート**を作成（例：実験スケジューラー）

## 1. 導入（いちばん簡単）
1. スプレッドシート → **拡張機能 → Apps Script**
2. プロジェクトが開いたら、**既存ファイルを削除**して、以下4つを作成：
   - Settings.gs / Templates.gs / Code.gs / Index.html
3. 本リポジトリの `src/*.gs` と `web/Index.html` を**それぞれコピペ**
4. `Settings.gs` の **SS_ID** を、あなたのシートURLの `/d/` と `/edit` の間の文字列に置換（角括弧禁止）
5. 保存

### 1-1. 初期セットアップ
- Apps Script で関数プルダウンから `setup` を実行 → 権限許可  
- スプレッドシートに次のシートが作られます：
  - `Slots / Responses / Confirmed / Archive / AddSlots / CancelOps / MailQueue`（**シート1は自動削除**）
  - トリガーが作られる
- **Settings.gsのSS_ID,枠生成,確定ポリシー,上限運用,表示/通知を使用者に合わせて修正**
- **Templates.gsの各種文案と研究同意書を使用者に合わせて修正**
- デプロイ → **新しいデプロイ** → 種類：Webアプリ  
  - 実行するユーザー：自分  
  - アクセスできるユーザー：全員（匿名含む） など要件に合わせて  
  - URL が予約ページとなる（**1ページ目が同意**、**2ページ目で日時**）

## 2. 導入（clasp を使ってGitHub管理）
```bash
npm i -g @google/clasp
clasp login
# シートは先に作っておく（URLのIDを Settings.gs の SS_ID に設定）
# 新規スクリプトを作る場合：
clasp create --title "実験スケジューラー" --type webapp
# ↓このリポジトリをローカルに取得して、中身をスクリプトのフォルダにコピー
clasp push
